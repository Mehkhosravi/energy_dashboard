{% extends "base.html" %}

{% block title %}Comune Overview{% endblock %}

{% block content %}
<section class="content">
  <div class="container-fluid">
    <h2>Energy Stats for {{ selected_comune.title() if selected_comune else "..." }}</h2>

    <form method="get" action="{{ url_for('comune_overview') }}" class="form-inline mb-4">
      <label for="comune" class="mr-2">Select Comune:</label>
      <select name="comune" id="comuneSelect" class="form-control mr-3" style="width: 300px;">
        <option value="">-- Choose --</option>
        {% for comune in comuni %}
        <option value="{{ comune }}" {% if comune == selected_comune %}selected{% endif %}>
          {{ comune.title() }}
        </option>
        {% endfor %}
      </select>

      <label for="time_period" class="mr-2">Time:</label>
      <select name="time_period" class="form-control mr-3" style="width: 300px;">
        <option value="month" {% if selected_time == 'month' %}selected{% endif %}>Monthly</option>
        <option value="week" {% if selected_time == 'week' %}selected{% endif %}>Weekly</option>
        <option value="day" {% if selected_time == 'day' %}selected{% endif %}>Daily</option>
        <option value="year" {% if selected_time == 'year' %}selected{% endif %}>Yearly</option>
      </select>

      <button type="submit" class="btn btn-primary">Show</button>
    </form>

    {% if chart_data %}
      <canvas id="comuneChart" height="100"></canvas>
    {% else %}
      <p>No chart data available. Please select a comune.</p>
    {% endif %}
  </div>
</section>
{% endblock %}

{% block scripts %}
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Select2 -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Pass chart_data to JavaScript -->
<script>
  let chartData = null;
  {% if chart_data %}
    chartData = {{ chart_data | tojson | safe }};
  {% else %}
    chartData = null;
  {% endif %}
</script>


<!-- Load external JS for Comune Overview -->
<script src="{{ url_for('static', filename='js/comune_overview.js') }}"></script>

{% endblock %}
